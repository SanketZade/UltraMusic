// This file has been autogenerated from a class added in the UI designer.

using System;
using System.Collections.Generic;
using AppKit;
using CoreGraphics;
using Foundation;
using UltraMusic.Portable.Models;
using WebKit;

namespace UltraMusic.Views
{
    public partial class MasterDetailController :
    NSSplitViewController
    {
        private SideBarController leftController;
        private WebRendererController rightController;

        public MasterDetailController(IntPtr handle) : base(handle)
        {
        }

        public override void ViewDidLoad()
        {
            base.ViewDidLoad();

            var children = ChildViewControllers;
            leftController = SideBarItem.ViewController as SideBarController;
            rightController = WebRendererItem.ViewController as WebRendererController;

            leftController.ProviderClicked += RenderProvider;
        }

        private void RenderProvider(MusicProvider provider)
        {
            if (rightController.View.Subviews.Length > 0)
            {
                rightController.View.Subviews[0].RemoveFromSuperview();
            }
            var webView = GetView(provider, rightController.View.Frame);
            rightController.View.AddSubview(webView);
        }

        private Dictionary<string, WKWebView> webViews;

        private WKWebView GetView(MusicProvider provider, CGRect rect)
        {
            if (webViews == null)
                webViews = new Dictionary<string, WKWebView>();
            if (!webViews.ContainsKey(provider.Id))
            {
                var webView = new WKWebView(rect, new WKWebViewConfiguration())
                {
                    CustomUserAgent = "Mozilla/5.0 " +
                    "(Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 " +
                    "(KHTML, like Gecko) Version/12.0 Safari/605.1.15",
                    AutoresizingMask = NSViewResizingMask.HeightSizable | NSViewResizingMask.WidthSizable
                };

                var req = new NSUrlRequest(new NSUrl(provider.Url));
                webView.LoadRequest(req);
                webViews[provider.Id] = webView;
            }
            return webViews[provider.Id];
        }
    }
}
